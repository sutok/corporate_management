# 営業日報システム テスト仕様書

## 目次
1. [テスト概要](#テスト概要)
2. [テスト戦略](#テスト戦略)
3. [単体テスト](#単体テスト)
4. [結合テスト](#結合テスト)
5. [E2Eテスト](#e2eテスト)
6. [非機能テスト](#非機能テスト)
7. [テスト環境](#テスト環境)
8. [テスト実施計画](#テスト実施計画)

---

## テスト概要

### テスト目的
- システムが要件定義通りに動作することを確認
- バグやセキュリティ脆弱性の早期発見
- リリース前の品質保証
- リグレッション（機能退行）の防止

### テスト範囲
- フロントエンド（画面表示、ユーザー操作）
- バックエンド（API、ビジネスロジック）
- データベース（データ整合性、トランザクション）
- セキュリティ（認証・認可、脆弱性）
- パフォーマンス（レスポンス時間、負荷耐性）

### テストレベル

| テストレベル | 実施者 | カバレッジ目標 |
|------------|--------|--------------|
| 単体テスト | 開発者 | 80%以上 |
| 結合テスト | 開発者/QA | 70%以上 |
| E2Eテスト | QA | 主要シナリオ100% |
| 非機能テスト | QA/DevOps | 要件準拠 |

---

## テスト戦略

### テストピラミッド

```
        /\
       /E2E\         少ない（主要シナリオのみ）
      /------\
     /統合テスト\      中程度（API、コンポーネント結合）
    /----------\
   /  単体テスト  \    多い（関数、メソッド、コンポーネント）
  /--------------\
```

### テスト優先度

| 優先度 | 説明 | テスト対象例 |
|--------|------|------------|
| P0（Critical） | システム停止につながる機能 | 認証、日報作成、データ保存 |
| P1（High） | 主要機能 | 日報編集、コメント、顧客管理 |
| P2（Medium） | 一般機能 | 検索、フィルタリング、ソート |
| P3（Low） | 補助機能 | UI装飾、ツールチップ |

### テスト自動化方針

| テスト種別 | 自動化率目標 | ツール |
|----------|------------|--------|
| 単体テスト | 100% | Jest, pytest |
| 結合テスト | 80% | Jest, pytest, Postman |
| E2Eテスト | 60% | Playwright, Cypress |
| 非機能テスト | 50% | JMeter, OWASP ZAP |

---

## 単体テスト

### バックエンド単体テスト

#### 認証機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-AUTH-001 | ログイン成功 | 正しいメールアドレスとパスワードでログイン | JWTトークンが返却される | P0 |
| UT-AUTH-002 | ログイン失敗（パスワード不正） | 誤ったパスワードでログイン試行 | 401エラーが返却される | P0 |
| UT-AUTH-003 | ログイン失敗（存在しないユーザー） | 未登録のメールアドレスでログイン試行 | 401エラーが返却される | P0 |
| UT-AUTH-004 | トークンリフレッシュ成功 | 有効なリフレッシュトークンで更新 | 新しいアクセストークンが返却される | P1 |
| UT-AUTH-005 | トークンリフレッシュ失敗 | 無効なリフレッシュトークンで更新 | 401エラーが返却される | P1 |
| UT-AUTH-006 | パスワードハッシュ化 | パスワードがbcryptでハッシュ化される | ハッシュ値が生成される | P0 |
| UT-AUTH-007 | ログイン試行回数制限 | 5回連続ログイン失敗 | アカウントロック（10分間） | P1 |

#### 日報機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-REPORT-001 | 日報作成成功 | 必須項目を満たした日報作成 | 日報がDBに保存される | P0 |
| UT-REPORT-002 | 日報作成失敗（必須項目不足） | 訪問記録なしで日報作成 | 422エラーが返却される | P0 |
| UT-REPORT-003 | 日報作成失敗（未来日） | 未来の報告日で日報作成 | 422エラーが返却される | P1 |
| UT-REPORT-004 | 日報更新成功 | 編集期限内に日報更新 | 日報が更新される | P0 |
| UT-REPORT-005 | 日報更新失敗（期限切れ） | 編集期限を過ぎた日報を更新 | 403エラーが返却される | P1 |
| UT-REPORT-006 | 日報削除成功 | 作成者本人が日報削除 | 日報が削除される | P1 |
| UT-REPORT-007 | 日報削除失敗（権限なし） | 他人の日報を削除試行 | 403エラーが返却される | P1 |
| UT-REPORT-008 | 日報一覧取得（自分のみ） | 営業担当者が日報一覧取得 | 自分の日報のみ返却される | P1 |
| UT-REPORT-009 | 日報一覧取得（部下含む） | 上長が日報一覧取得 | 部下の日報も返却される | P1 |
| UT-REPORT-010 | ダッシュボード情報取得 | 本日・今週のサマリー取得 | 正しい集計値が返却される | P2 |

#### 訪問記録機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-VISIT-001 | 訪問記録追加成功 | 日報に訪問記録を追加 | 訪問記録がDBに保存される | P0 |
| UT-VISIT-002 | 訪問記録追加失敗（必須項目不足） | 顧客ID未指定で追加 | 422エラーが返却される | P1 |
| UT-VISIT-003 | 訪問記録更新成功 | リモート種別を変更 | 訪問記録が更新される | P1 |
| UT-VISIT-004 | 訪問記録削除成功 | 訪問記録を削除 | 訪問記録が削除される | P1 |
| UT-VISIT-005 | リモート種別デフォルト値 | remote未指定で作成 | falseがセットされる | P2 |

#### 課題・計画機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-PROBLEM-001 | 課題追加成功 | 日報に課題を追加 | 課題がDBに保存される | P1 |
| UT-PROBLEM-002 | 課題ステータス更新 | 課題を解決済に変更 | ステータスが更新される | P1 |
| UT-PLAN-001 | 計画追加成功 | 日報に計画を追加 | 計画がDBに保存される | P1 |
| UT-PLAN-002 | 計画削除成功 | 計画を削除 | 計画が削除される | P2 |

#### コメント機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-COMMENT-001 | コメント追加成功（上長） | 上長がコメントを追加 | コメントがDBに保存される | P1 |
| UT-COMMENT-002 | コメント追加失敗（営業） | 営業担当者がコメント追加試行 | 403エラーが返却される | P1 |
| UT-COMMENT-003 | コメント削除成功 | 作成者本人がコメント削除 | コメントが削除される | P2 |
| UT-COMMENT-004 | コメント一覧取得 | 日報のコメント一覧取得 | コメントリストが返却される | P1 |

#### 顧客マスタ機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-CUSTOMER-001 | 顧客登録成功 | 必須項目を満たした顧客登録 | 顧客がDBに保存される | P0 |
| UT-CUSTOMER-002 | 顧客登録失敗（必須項目不足） | 顧客名未入力で登録 | 422エラーが返却される | P1 |
| UT-CUSTOMER-003 | 顧客更新成功 | 顧客情報を更新 | 顧客情報が更新される | P1 |
| UT-CUSTOMER-004 | 顧客削除成功 | 訪問記録がない顧客を削除 | 顧客が削除される | P1 |
| UT-CUSTOMER-005 | 顧客削除失敗（訪問記録あり） | 訪問記録がある顧客を削除試行 | 409エラーが返却される | P1 |
| UT-CUSTOMER-006 | 顧客検索（キーワード） | 顧客名で部分一致検索 | 該当顧客が返却される | P2 |

#### ユーザーマスタ機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-USER-001 | ユーザー登録成功 | 必須項目を満たしたユーザー登録 | ユーザーがDBに保存される | P0 |
| UT-USER-002 | ユーザー登録失敗（メール重複） | 既存のメールアドレスで登録 | 409エラーが返却される | P1 |
| UT-USER-003 | ユーザー更新成功 | ユーザー情報を更新 | ユーザー情報が更新される | P1 |
| UT-USER-004 | ユーザー削除失敗（日報あり） | 日報があるユーザーを削除試行 | 409エラーが返却される | P1 |
| UT-USER-005 | ユーザー削除失敗（自分自身） | 自分自身を削除試行 | 403エラーが返却される | P1 |

#### 支店マスタ機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-BRANCH-001 | 支店登録成功 | 必須項目を満たした支店登録 | 支店がDBに保存される | P0 |
| UT-BRANCH-002 | 支店登録失敗（必須項目不足） | 支店名未入力で登録 | 422エラーが返却される | P1 |
| UT-BRANCH-003 | 支店更新成功 | 支店情報を更新 | 支店情報が更新される | P1 |
| UT-BRANCH-004 | 支店削除成功 | 部署がない支店を削除 | 支店が削除される | P1 |
| UT-BRANCH-005 | 支店削除失敗（部署あり） | 部署がある支店を削除試行 | 409エラーが返却される | P1 |
| UT-BRANCH-006 | 支店一覧取得 | 支店一覧を取得 | 支店リストが返却される | P1 |

#### 部署マスタ機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-DEPT-001 | 部署登録成功 | 必須項目を満たした部署登録 | 部署がDBに保存される | P0 |
| UT-DEPT-002 | 部署登録失敗（必須項目不足） | 部署名未入力で登録 | 422エラーが返却される | P1 |
| UT-DEPT-003 | 部署登録失敗（支店未選択） | 所属支店未選択で登録 | 422エラーが返却される | P1 |
| UT-DEPT-004 | 部署更新成功 | 部署情報を更新 | 部署情報が更新される | P1 |
| UT-DEPT-005 | 部署削除成功 | ユーザーが所属しない部署を削除 | 部署が削除される | P1 |
| UT-DEPT-006 | 部署削除失敗（ユーザーあり） | ユーザーが所属する部署を削除試行 | 409エラーが返却される | P1 |
| UT-DEPT-007 | 部署検索（支店で絞り込み） | 支店IDで部署を絞り込み | 該当支店の部署が返却される | P2 |

#### ユーザー所属管理機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-ASSIGN-001 | 支店所属追加成功 | ユーザーを支店に所属させる | 所属がDBに保存される | P0 |
| UT-ASSIGN-002 | 部署所属追加成功 | ユーザーを部署に所属させる | 所属がDBに保存される | P0 |
| UT-ASSIGN-003 | 主所属支店設定 | 主所属支店を変更 | is_primaryが更新される | P1 |
| UT-ASSIGN-004 | 主所属部署設定 | 主所属部署を変更 | is_primaryが更新される | P1 |
| UT-ASSIGN-005 | 支店所属削除成功 | 複数所属から1つ削除 | 所属が削除される | P1 |
| UT-ASSIGN-006 | 支店所属削除失敗（最後の所属） | 最後の支店所属を削除試行 | 400エラーが返却される | P1 |
| UT-ASSIGN-007 | 部署所属削除成功 | 複数所属から1つ削除 | 所属が削除される | P1 |
| UT-ASSIGN-008 | 部署所属削除失敗（最後の所属） | 最後の部署所属を削除試行 | 400エラーが返却される | P1 |
| UT-ASSIGN-009 | ユーザー所属情報取得 | 所属情報を取得 | 支店・部署の所属リストが返却される | P1 |

#### サービスマスタ機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-SERVICE-001 | サービス登録成功 | 必須項目を満たしたサービス登録 | サービスがDBに保存される | P0 |
| UT-SERVICE-002 | サービス登録失敗（サービスコード重複） | 既存サービスコードで登録試行 | 409エラーが返却される | P1 |
| UT-SERVICE-003 | サービス登録失敗（必須項目不足） | サービス名未入力で登録 | 422エラーが返却される | P1 |
| UT-SERVICE-004 | サービス更新成功 | サービス情報を更新 | サービス情報が更新される | P1 |
| UT-SERVICE-005 | サービス削除成功 | 契約企業がないサービスを削除 | サービスが削除される | P1 |
| UT-SERVICE-006 | サービス削除失敗（契約企業あり） | 契約企業があるサービスを削除試行 | 409エラーが返却される | P1 |
| UT-SERVICE-007 | サービス検索（名称部分一致） | サービス名で部分一致検索 | 該当サービスが返却される | P2 |
| UT-SERVICE-008 | サービス検索（提供状態フィルタ） | 提供状態で絞り込み | 該当サービスが返却される | P2 |

#### 企業サービス契約機能

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-SUBSCRIPTION-001 | サービス契約追加成功 | 企業に新規サービス契約を追加 | 契約がDBに保存される | P0 |
| UT-SUBSCRIPTION-002 | サービス契約追加失敗（重複） | 既に契約済みのサービスを追加試行 | 409エラーが返却される | P1 |
| UT-SUBSCRIPTION-003 | サービス契約更新成功 | 契約状態をsuspendedに変更 | 契約状態が更新される | P1 |
| UT-SUBSCRIPTION-004 | サービス契約削除成功 | サービス契約を削除 | 契約が削除される | P1 |
| UT-SUBSCRIPTION-005 | サービス有効性チェック（有効） | status=activeの契約をチェック | is_available=trueが返却される | P0 |
| UT-SUBSCRIPTION-006 | サービス有効性チェック（無効） | status=suspendedの契約をチェック | is_available=falseが返却される | P0 |
| UT-SUBSCRIPTION-007 | サービス有効性チェック（未契約） | 未契約サービスをチェック | is_available=falseが返却される | P1 |
| UT-SUBSCRIPTION-008 | 契約終了日チェック | 終了日を過ぎた契約をチェック | is_available=falseが返却される | P1 |
| UT-SUBSCRIPTION-009 | 企業別契約一覧取得 | 企業のサービス契約一覧取得 | 全契約情報が返却される | P1 |
| UT-SUBSCRIPTION-010 | 権限チェック（システム管理者） | システム管理者で契約管理 | 全操作が可能 | P0 |
| UT-SUBSCRIPTION-011 | 権限チェック（管理者） | 管理者で契約管理試行 | 403エラーが返却される | P0 |

### フロントエンド単体テスト

#### コンポーネントテスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| UT-FE-001 | ログインフォーム表示 | ログインフォームがレンダリングされる | メールとパスワード入力欄が表示される | P0 |
| UT-FE-002 | ログインフォームバリデーション | 空欄でログインボタンクリック | エラーメッセージが表示される | P1 |
| UT-FE-003 | 日報作成フォーム表示 | 日報作成フォームがレンダリングされる | 必須項目が表示される | P0 |
| UT-FE-004 | 訪問記録追加ボタン | 訪問記録追加ボタンクリック | 新しい入力行が追加される | P1 |
| UT-FE-005 | 顧客選択ドロップダウン | 顧客選択ドロップダウンを開く | 顧客リストが表示される | P1 |
| UT-FE-006 | リモート種別ラジオボタン | リモート種別を選択 | 選択状態が変更される | P2 |
| UT-FE-007 | コメント入力フォーム（上長） | 上長でログイン | コメント入力フォームが表示される | P1 |
| UT-FE-008 | コメント入力フォーム（営業） | 営業でログイン | コメント入力フォームが非表示 | P1 |

---

## 結合テスト

### API結合テスト

#### 日報作成フロー

| テストケースID | テスト項目 | テスト手順 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| IT-FLOW-001 | 日報作成完全フロー | 1. ログイン<br>2. 顧客マスタから顧客選択<br>3. 訪問記録入力<br>4. 課題・計画入力<br>5. 日報作成<br>6. 日報詳細表示 | 全データが正しく保存・表示される | P0 |
| IT-FLOW-002 | 日報編集フロー | 1. 日報作成<br>2. 日報編集画面表示<br>3. 訪問記録追加<br>4. 日報更新<br>5. 日報詳細表示 | 更新内容が正しく反映される | P0 |
| IT-FLOW-003 | 上長コメントフロー | 1. 営業が日報作成<br>2. 上長でログイン<br>3. 部下の日報表示<br>4. コメント追加<br>5. コメントが保存される | コメントが正しく保存・表示される | P1 |

#### 権限制御統合テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| IT-AUTH-001 | 営業担当者の権限 | 営業担当者が他人の日報編集試行 | 403エラーが返却される | P0 |
| IT-AUTH-002 | 上長の権限 | 上長が部下の日報閲覧 | 正常に閲覧できる | P1 |
| IT-AUTH-003 | 管理者の権限 | 管理者がユーザーマスタ操作 | 全操作が可能 | P1 |
| IT-AUTH-004 | 未認証ユーザー | トークンなしでAPI呼び出し | 401エラーが返却される | P0 |
| IT-AUTH-005 | トークン期限切れ | 期限切れトークンでAPI呼び出し | 401エラーが返却される | P0 |

#### データ整合性テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| IT-DATA-001 | 日報削除時の関連データ | 日報削除実行 | 訪問記録、課題、計画も削除される（カスケード） | P0 |
| IT-DATA-002 | 顧客削除時のバリデーション | 訪問記録がある顧客を削除 | 409エラーで削除が阻止される | P1 |
| IT-DATA-003 | ユーザー削除時のバリデーション | 日報があるユーザーを削除 | 409エラーで削除が阻止される | P1 |
| IT-DATA-004 | 訪問記録の顧客参照 | 顧客IDが不正な訪問記録作成 | 422エラーが返却される | P1 |

#### サービス管理統合テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| IT-SERVICE-001 | サービス契約とアクセス制御 | 1. DAILY_REPORTサービス契約を無効化<br>2. 日報作成APIを呼び出し | 403エラー（SERVICE_NOT_AVAILABLE）が返却される | P0 |
| IT-SERVICE-002 | サービス有効化と機能利用 | 1. DAILY_REPORTサービス契約を有効化<br>2. 日報作成APIを呼び出し | 日報が正常に作成される | P0 |
| IT-SERVICE-003 | 契約終了日チェック | 1. サービス契約の終了日を過去日に設定<br>2. サービス有効性チェック | is_available=falseが返却される | P1 |
| IT-SERVICE-004 | システム管理者権限チェック | 1. システム管理者でサービス管理操作<br>2. 管理者でサービス管理操作試行 | システム管理者のみ操作可能 | P0 |

---

## E2Eテスト

### ユーザーシナリオテスト

#### シナリオ1: 日報作成から承認まで（営業担当者）

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | ログイン画面でメールアドレス・パスワード入力 | ログイン成功、ダッシュボード表示 |
| 2 | 「日報作成」ボタンクリック | 日報作成画面が表示される |
| 3 | 報告日を選択 | 日付ピッカーで選択可能 |
| 4 | 訪問記録の顧客を選択 | ドロップダウンから顧客選択 |
| 5 | 訪問日時、訪問内容を入力 | 入力欄にテキスト入力可能 |
| 6 | リモート種別で「対面」を選択 | ラジオボタンが選択される |
| 7 | 課題を入力 | テキストエリアに入力可能 |
| 8 | 計画を入力 | テキストエリアに入力可能 |
| 9 | 「登録」ボタンクリック | 日報一覧画面に遷移、成功メッセージ表示 |
| 10 | 作成した日報の「詳細」ボタンクリック | 日報詳細画面が表示され、入力内容が正しく表示される |

**テストケースID**: E2E-SCENARIO-001
**優先度**: P0

---

#### シナリオ2: 日報確認とコメント（上長）

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | 上長アカウントでログイン | ダッシュボード表示 |
| 2 | 「日報一覧」ボタンクリック | 日報一覧画面が表示される |
| 3 | 部下の日報を検索（ユーザー選択） | 該当する日報が表示される |
| 4 | 日報の「詳細」ボタンクリック | 日報詳細画面が表示される |
| 5 | コメント入力欄にフィードバックを入力 | テキストエリアに入力可能 |
| 6 | 「コメント投稿」ボタンクリック | コメントが投稿され、画面に表示される |
| 7 | ログアウト | ログイン画面に戻る |

**テストケースID**: E2E-SCENARIO-002
**優先度**: P1

---

#### シナリオ3: 顧客登録と日報作成

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | ログイン | ダッシュボード表示 |
| 2 | 「顧客一覧」ボタンクリック | 顧客マスタ一覧画面が表示される |
| 3 | 「新規登録」ボタンクリック | 顧客マスタ登録画面が表示される |
| 4 | 顧客情報を入力（顧客名、会社名、電話番号など） | 全項目に入力可能 |
| 5 | 「登録」ボタンクリック | 顧客一覧画面に遷移、成功メッセージ表示 |
| 6 | 「日報作成」ボタンクリック | 日報作成画面が表示される |
| 7 | 顧客ドロップダウンで新規登録した顧客を選択 | 顧客が選択肢に表示され、選択可能 |
| 8 | 訪問記録を入力して日報作成 | 日報が正常に作成される |

**テストケースID**: E2E-SCENARIO-003
**優先度**: P1

---

#### シナリオ4: 日報編集と削除

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | ログイン | ダッシュボード表示 |
| 2 | 日報一覧から自分の日報を選択 | 日報詳細画面が表示される |
| 3 | 「編集」ボタンクリック | 日報編集画面が表示される |
| 4 | 訪問記録を追加 | 新しい訪問記録行が追加される |
| 5 | 訪問内容を修正 | テキストが編集可能 |
| 6 | 「更新」ボタンクリック | 日報詳細画面に遷移、更新内容が反映される |
| 7 | 「削除」ボタンクリック | 確認ダイアログが表示される |
| 8 | 確認ダイアログで「削除」を選択 | 日報一覧画面に遷移、日報が削除される |

**テストケースID**: E2E-SCENARIO-004
**優先度**: P1

---

#### シナリオ5: ユーザー管理（管理者）

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | 管理者アカウントでログイン | ダッシュボード表示 |
| 2 | 「ユーザー一覧」メニューをクリック | ユーザーマスタ一覧画面が表示される |
| 3 | 「新規登録」ボタンクリック | ユーザーマスタ登録画面が表示される |
| 4 | ユーザー情報を入力 | 全項目に入力可能 |
| 5 | 「登録」ボタンクリック | ユーザー一覧画面に遷移、新規ユーザーが表示される |
| 6 | 登録したユーザーの「編集」ボタンクリック | ユーザーマスタ編集画面が表示される |
| 7 | 役割を「営業」から「上長」に変更 | 役割が変更可能 |
| 8 | 「更新」ボタンクリック | ユーザー一覧画面に遷移、更新内容が反映される |

**テストケースID**: E2E-SCENARIO-005
**優先度**: P1

---

#### シナリオ6: サービス管理（システム管理者）

| ステップ | 操作 | 期待結果 |
|---------|------|---------|
| 1 | システム管理者アカウントでログイン | ダッシュボード表示 |
| 2 | 「サービス一覧」メニューをクリック | サービスマスタ一覧画面が表示される |
| 3 | 「新規登録」ボタンクリック | サービスマスタ登録画面が表示される |
| 4 | サービス情報を入力（サービスコード、サービス名、基本料金など） | 全項目に入力可能 |
| 5 | 「登録」ボタンクリック | サービス一覧画面に遷移、新規サービスが表示される |
| 6 | 「企業サービス契約管理」メニューをクリック | 企業サービス契約管理画面が表示される |
| 7 | 企業を選択 | 企業の現在の契約状況が表示される |
| 8 | 新規サービスを選択して契約追加 | サービス契約が追加され、契約一覧に表示される |
| 9 | 契約状態を「active」から「suspended」に変更 | 契約状態が更新される |
| 10 | ログアウトして通常ユーザーでログイン | 一時停止したサービス機能へのアクセスが拒否される |

**テストケースID**: E2E-SCENARIO-006
**優先度**: P1

---

### クロスブラウザテスト

| テストケースID | ブラウザ | バージョン | テスト内容 | 優先度 |
|--------------|---------|-----------|----------|--------|
| E2E-BROWSER-001 | Chrome | 最新版 | 全主要機能の動作確認 | P0 |
| E2E-BROWSER-002 | Firefox | 最新版 | 全主要機能の動作確認 | P1 |
| E2E-BROWSER-003 | Safari | 最新版 | 全主要機能の動作確認 | P1 |
| E2E-BROWSER-004 | Edge | 最新版 | 全主要機能の動作確認 | P2 |

### レスポンシブデザインテスト

| テストケースID | デバイス | 解像度 | テスト内容 | 優先度 |
|--------------|---------|--------|----------|--------|
| E2E-RESPONSIVE-001 | PC | 1920x1080 | レイアウト崩れがない | P0 |
| E2E-RESPONSIVE-002 | タブレット | 1024x768 | レイアウト崩れがない | P1 |
| E2E-RESPONSIVE-003 | スマートフォン | 375x667 | レイアウト崩れがない、ハンバーガーメニュー表示 | P1 |

---

## 非機能テスト

### パフォーマンステスト

#### レスポンスタイム測定

| テストケースID | テスト項目 | 測定項目 | 目標値 | 優先度 |
|--------------|----------|---------|--------|--------|
| PERF-001 | ログインAPI | レスポンスタイム | 500ms以内 | P0 |
| PERF-002 | 日報一覧取得API | レスポンスタイム | 1秒以内 | P0 |
| PERF-003 | 日報作成API | レスポンスタイム | 1秒以内 | P0 |
| PERF-004 | ダッシュボード表示 | ページロード時間 | 2秒以内 | P1 |
| PERF-005 | 顧客一覧取得API（100件） | レスポンスタイム | 1秒以内 | P1 |

#### 負荷テスト

| テストケースID | テスト項目 | 条件 | 目標値 | 優先度 |
|--------------|----------|------|--------|--------|
| LOAD-001 | 同時ログイン | 100ユーザー同時ログイン | エラー率5%以下 | P1 |
| LOAD-002 | 日報作成負荷 | 50ユーザー同時に日報作成 | エラー率5%以下 | P1 |
| LOAD-003 | API呼び出し負荷 | 1000リクエスト/秒 | レスポンスタイム2秒以内 | P2 |
| LOAD-004 | データベース負荷 | 10,000件の日報データ | クエリ実行1秒以内 | P2 |

#### ストレステスト

| テストケースID | テスト項目 | 条件 | 目標値 | 優先度 |
|--------------|----------|------|--------|--------|
| STRESS-001 | 最大同時接続数 | 500ユーザー同時接続 | サーバーダウンしない | P1 |
| STRESS-002 | メモリリーク検証 | 24時間連続稼働 | メモリ使用量が安定 | P2 |

### セキュリティテスト

#### 認証・認可テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| SEC-AUTH-001 | 未認証アクセス | トークンなしでAPI呼び出し | 401エラーが返却される | P0 |
| SEC-AUTH-002 | トークン改ざん | トークンを改ざんしてAPI呼び出し | 401エラーが返却される | P0 |
| SEC-AUTH-003 | トークン期限切れ | 期限切れトークンでAPI呼び出し | 401エラーが返却される | P0 |
| SEC-AUTH-004 | 権限外操作 | 営業担当者が管理者APIを呼び出し | 403エラーが返却される | P0 |
| SEC-AUTH-005 | CSRF対策 | CSRFトークンなしでPOST送信 | 拒否される | P1 |

#### 脆弱性テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| SEC-VUL-001 | SQLインジェクション | 入力欄に`'; DROP TABLE users; --`を入力 | エスケープされ、SQLが実行されない | P0 |
| SEC-VUL-002 | XSS（反射型） | 入力欄に`<script>alert('XSS')</script>`を入力 | サニタイズされ、スクリプトが実行されない | P0 |
| SEC-VUL-003 | XSS（格納型） | 日報にスクリプトを含むテキストを保存 | サニタイズされ、表示時に実行されない | P0 |
| SEC-VUL-004 | パストラバーサル | ファイルパスに`../../etc/passwd`を指定 | アクセスが拒否される | P0 |
| SEC-VUL-005 | ブルートフォース攻撃 | 連続ログイン試行 | レート制限により拒否される | P1 |
| SEC-VUL-006 | セッションハイジャック | 他人のセッショントークンを使用 | アクセスが拒否される | P0 |

#### データ保護テスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| SEC-DATA-001 | パスワードハッシュ化 | DBに保存されたパスワード確認 | bcryptでハッシュ化されている | P0 |
| SEC-DATA-002 | HTTPS通信 | HTTP接続を試行 | HTTPSへリダイレクトされる | P0 |
| SEC-DATA-003 | 機密情報ログ出力 | ログファイルを確認 | パスワード等が出力されていない | P1 |

### ユーザビリティテスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| USABILITY-001 | エラーメッセージ | バリデーションエラー発生 | ユーザーが理解できるメッセージが表示される | P1 |
| USABILITY-002 | 成功メッセージ | 日報作成成功 | トースト通知で成功が通知される | P2 |
| USABILITY-003 | ローディング表示 | API処理中 | ローディングインジケーターが表示される | P2 |
| USABILITY-004 | フォームバリデーション | 入力エラー | エラー項目が赤枠で強調される | P1 |

### アクセシビリティテスト

| テストケースID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|--------------|----------|----------|---------|--------|
| A11Y-001 | キーボード操作 | Tabキーで全フォームを操作 | フォーカスが順番に移動する | P2 |
| A11Y-002 | スクリーンリーダー対応 | スクリーンリーダーで読み上げ | 適切なaria属性が設定されている | P2 |
| A11Y-003 | コントラスト比 | 色のコントラストを測定 | WCAG AA基準を満たす | P2 |

---

## テスト環境

### 環境構成

| 環境 | 用途 | URL |
|------|------|-----|
| 開発環境 | 開発者による単体テスト | http://localhost:3000 |
| テスト環境 | QAによる結合・E2Eテスト | https://test.sales-report.example.com |
| ステージング環境 | 本番同等環境でのテスト | https://staging.sales-report.example.com |
| 本番環境 | 実運用環境 | https://sales-report.example.com |

### テストデータ

#### マスタデータ

| データ種別 | 件数 | 備考 |
|----------|------|------|
| 企業 | 1件 | サンプル商事株式会社 |
| ユーザー | 10件 | 営業7名、上長2名、管理者1名 |
| 顧客 | 50件 | 各営業担当者に5〜10件割り当て |
| サービス | 3件 | DAILY_REPORT、CUSTOMER_MANAGE、ANALYTICS |
| サービス契約 | 2件 | DAILY_REPORT（active）、CUSTOMER_MANAGE（suspended） |

#### トランザクションデータ

| データ種別 | 件数 | 備考 |
|----------|------|------|
| 日報 | 100件 | 過去3ヶ月分 |
| 訪問記録 | 300件 | 1日報あたり1〜5件 |
| 課題 | 50件 | - |
| 計画 | 150件 | - |
| コメント | 80件 | - |

### テストツール

| ツール名 | 用途 | 備考 |
|---------|------|------|
| Jest | フロントエンド単体テスト | React向け |
| pytest | バックエンド単体テスト | Python向け |
| Postman / Newman | API結合テスト | 自動化対応 |
| Playwright | E2Eテスト | クロスブラウザ対応 |
| JMeter | 負荷テスト | パフォーマンス測定 |
| OWASP ZAP | セキュリティテスト | 脆弱性スキャン |
| SonarQube | コード品質分析 | 静的解析 |

---

## テスト実施計画

### テストスケジュール

| フェーズ | 期間 | 担当 | 成果物 |
|---------|------|------|--------|
| 単体テスト | 開発期間中 | 開発者 | テストコード、カバレッジレポート |
| 結合テスト | 開発完了後1週間 | 開発者/QA | テスト結果レポート |
| E2Eテスト | 結合テスト完了後1週間 | QA | テストシナリオ結果 |
| 非機能テスト | E2Eテスト完了後3日 | QA/DevOps | パフォーマンスレポート、脆弱性診断書 |
| リグレッションテスト | リリース前3日 | QA | 最終確認レポート |

### 合格基準

| テスト種別 | 合格基準 |
|----------|---------|
| 単体テスト | カバレッジ80%以上、全テストケース成功 |
| 結合テスト | P0/P1優先度のテストケース100%成功 |
| E2Eテスト | 主要シナリオ100%成功 |
| パフォーマンステスト | 目標値を90%以上達成 |
| セキュリティテスト | 重大な脆弱性0件 |

### バグ管理

#### バグ優先度

| 優先度 | 定義 | 対応期限 |
|--------|------|---------|
| Critical | システム停止、データ損失 | 即時 |
| High | 主要機能が動作しない | 24時間以内 |
| Medium | 機能に支障があるが回避可能 | 1週間以内 |
| Low | UIの軽微な問題 | 次回リリース |

#### バグレポート項目

- バグID
- 発見日時
- 発見者
- 優先度
- テストケースID
- 再現手順
- 期待結果
- 実際の結果
- スクリーンショット
- 環境情報
- ステータス（Open, In Progress, Fixed, Closed）

---

## テスト自動化

### CI/CDパイプライン統合

```yaml
# GitHubActions / GitLab CI 例
stages:
  - lint
  - unit-test
  - integration-test
  - e2e-test
  - security-test
  - deploy

unit-test:
  script:
    - npm run test:unit
    - pytest tests/unit
  coverage: 80%

integration-test:
  script:
    - npm run test:integration
    - pytest tests/integration

e2e-test:
  script:
    - npx playwright test

security-test:
  script:
    - npm audit
    - safety check
    - zap-baseline.py -t https://staging.example.com
```

### 継続的テスト

- **プルリクエスト時**: 単体テスト、Lint
- **マージ時**: 単体テスト、結合テスト
- **ステージングデプロイ時**: E2Eテスト、セキュリティテスト
- **本番デプロイ前**: 全テストスイート実行
- **定期実行**: 毎日深夜にリグレッションテスト

---

## テスト報告

### テストレポート項目

- テスト実施日
- テスト担当者
- テスト対象バージョン
- テスト環境
- 実施テストケース数
- 成功/失敗/スキップ数
- カバレッジ率
- 発見バグ数（優先度別）
- パフォーマンス測定結果
- 総合評価
- 備考・所見

### テスト完了条件

以下の条件を全て満たした場合、テスト完了とする：

1. 単体テストカバレッジ80%以上達成
2. P0/P1テストケース100%成功
3. Critical/Highバグ0件
4. パフォーマンステスト目標値90%以上達成
5. セキュリティテストで重大な脆弱性0件
6. E2E主要シナリオ100%成功
7. テストレポート作成完了

---

**作成日**: 2025-12-31
**バージョン**: 1.0
**承認者**: -
**次回レビュー日**: リリース後1ヶ月
